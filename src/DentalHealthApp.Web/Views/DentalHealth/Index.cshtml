@using DentalHealthApp.Core.Entities
@{
    ViewData["Title"] = "Ağız ve Diş Sağlığı";
    Layout = "_Layout";
}

<div class="container-fluid">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="bg-info text-white rounded-3 p-4">
                <div class="d-flex align-items-center">
                    <i class="fas fa-heartbeat me-3" style="font-size: 3rem;"></i>
                    <div>
                        <h2 class="mb-1">Ağız ve Diş Sağlığı Takip</h2>
                        <p class="mb-0 opacity-75">Sağlıklı alışkanlıklarınızı takip edin ve hedeflerinizi gerçekleştirin</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabs -->
    <ul class="nav nav-tabs nav-justified mb-4" id="healthTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="status-tab" data-bs-toggle="tab" data-bs-target="#status" type="button" role="tab">
                <i class="fas fa-chart-line me-2"></i>Durum
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="goals-tab" data-bs-toggle="tab" data-bs-target="#goals" type="button" role="tab">
                <i class="fas fa-target me-2"></i>Hedefler
            </button>
        </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content" id="healthTabsContent">
        <!-- Status Tab -->
        <div class="tab-pane fade show active" id="status" role="tabpanel">
            <!-- Last 7 Days Summary -->
            <div class="row mb-4">
                <div class="col-12">
                    <h5><i class="fas fa-calendar-week me-2 text-primary"></i>Son 7 Günlük Aktiviteler</h5>
                </div>
                @if (ViewBag.Activities != null && ((IEnumerable<dynamic>)ViewBag.Activities).Any())
                {
                    @foreach (var activity in ViewBag.Activities)
                    {
                        <div class="col-lg-4 col-md-6 mb-3">
                            <div class="card border-0 shadow-sm">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <h6 class="card-title">@activity.GoalTitle</h6>
                                            <p class="text-muted small mb-1">@activity.ActivityDate.ToString("dd/MM/yyyy")</p>
                                            @if (activity.IsCompleted)
                                            {
                                                <span class="badge bg-success">Tamamlandı</span>
                                            }
                                            else
                                            {
                                                <span class="badge bg-warning">Beklemede</span>
                                            }
                                        </div>
                                        <form asp-controller="DentalHealth" asp-action="DeleteActivity" method="post" class="d-inline">
                                            @Html.AntiForgeryToken()
                                            <input type="hidden" name="id" value="@activity.Id" />
                                            <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Bu aktiviteyi silmek istediğinizden emin misiniz?')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </form>
                                    </div>
                                    @if (!string.IsNullOrEmpty(activity.Notes))
                                    {
                                        <p class="card-text mt-2 small">@activity.Notes</p>
                                    }
                                </div>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div class="col-12">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>Henüz aktivite kaydınız bulunmuyor. 
                            <a asp-action="CreateActivity" class="alert-link">Yeni aktivite ekleyin</a>
                        </div>
                    </div>
                }
            </div>

            <!-- Notes Section -->
            <div class="row mb-4">
                <div class="col-12">
                    <h5><i class="fas fa-sticky-note me-2 text-warning"></i>Son Notlar</h5>
                </div>
                @if (ViewBag.Notes != null && ((IEnumerable<dynamic>)ViewBag.Notes).Any())
                {
                    @foreach (var note in ViewBag.Notes)
                    {
                        <div class="col-lg-4 col-md-6 mb-3">
                            <div class="card border-0 shadow-sm">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div class="flex-grow-1">
                                            <h6 class="card-title">@note.Title</h6>
                                            <p class="text-muted small mb-1">@note.NoteDate.ToString("dd/MM/yyyy")</p>
                                            <p class="card-text">@note.Content</p>
                                        </div>
                                        <form asp-controller="DentalHealth" asp-action="DeleteNote" method="post" class="d-inline">
                                            @Html.AntiForgeryToken()
                                            <input type="hidden" name="id" value="@note.Id" />
                                            <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Bu notu silmek istediğinizden emin misiniz?')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div class="col-12">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>Henüz notunuz bulunmuyor. 
                            <a asp-action="CreateNote" class="alert-link">Yeni not ekleyin</a>
                        </div>
                    </div>
                }
            </div>

            <!-- Quick Actions -->
            <div class="row mb-4">
                <div class="col-12">
                    <h5><i class="fas fa-plus-circle me-2 text-success"></i>Hızlı Eylemler</h5>
                </div>
                <div class="col-lg-4 col-md-6 mb-3">
                    <a asp-action="CreateActivity" class="card text-decoration-none h-100 border-0 shadow-sm">
                        <div class="card-body text-center text-primary">
                            <i class="fas fa-plus-circle mb-2" style="font-size: 2rem;"></i>
                            <h6>Aktivite Ekle</h6>
                        </div>
                    </a>
                </div>
                <div class="col-lg-4 col-md-6 mb-3">
                    <a asp-action="CreateNote" class="card text-decoration-none h-100 border-0 shadow-sm">
                        <div class="card-body text-center text-warning">
                            <i class="fas fa-sticky-note mb-2" style="font-size: 2rem;"></i>
                            <h6>Not Ekle</h6>
                        </div>
                    </a>
                </div>
            </div>

            <!-- Health Recommendations -->
            @if (ViewBag.Recommendations != null)
            {
                <div class="row">
                    <div class="col-12">
                        <h5><i class="fas fa-lightbulb me-2 text-info"></i>Sağlık Önerileri</h5>
                    </div>
                    @foreach (var recommendation in ViewBag.Recommendations)
                    {
                        <div class="col-lg-4 col-md-6 mb-3">
                            <div class="card h-100 border-0 shadow-sm">
                                <div class="card-body">
                                    <h6 class="card-title text-info">@recommendation.Title</h6>
                                    <p class="card-text small">@recommendation.Content</p>
                                    @if (!string.IsNullOrEmpty(recommendation.Category))
                                    {
                                        <span class="badge bg-light text-info">@recommendation.Category</span>
                                    }
                                </div>
                            </div>
                        </div>
                    }
                </div>
            }
        </div>

        <!-- Goals Tab -->
        <div class="tab-pane fade" id="goals" role="tabpanel">
            <div class="row mb-4">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5><i class="fas fa-target me-2 text-primary"></i>Hedeflerim</h5>
                        <a asp-action="CreateGoal" class="btn btn-success">
                            <i class="fas fa-plus me-2"></i>Yeni Hedef
                        </a>
                    </div>
                </div>
                @if (ViewBag.Goals != null && ((IEnumerable<dynamic>)ViewBag.Goals).Any())
                {
                    @foreach (var goal in ViewBag.Goals)
                    {
                        <div class="col-lg-6 col-md-12 mb-3">
                            <div class="card border-0 shadow-sm">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div class="flex-grow-1">
                                            <h6 class="card-title">@goal.Title</h6>
                                            @if (!string.IsNullOrEmpty(goal.Description))
                                            {
                                                <p class="card-text">@goal.Description</p>
                                            }
                                            <div class="d-flex gap-2 mb-2">
                                                <span class="badge bg-primary">
                                                    @switch((int)goal.Period)
                                                    {
                                                        case 1: <text>Günlük</text> break;
                                                        case 2: <text>Haftalık</text> break;
                                                        case 3: <text>Aylık</text> break;
                                                        default: <text>Bilinmiyor</text> break;
                                                    }
                                                </span>
                                                @{
                                                    var importanceClass = (int)goal.ImportanceLevel switch {
                                                        4 => "bg-danger",
                                                        3 => "bg-warning",
                                                        2 => "bg-info",
                                                        _ => "bg-secondary"
                                                    };
                                                    var importanceText = (int)goal.ImportanceLevel switch {
                                                        4 => "Kritik",
                                                        3 => "Yüksek",
                                                        2 => "Orta",
                                                        _ => "Düşük"
                                                    };
                                                }
                                                <span class="badge @importanceClass">
                                                    @importanceText
                                                </span>
                                            </div>
                                            <small class="text-muted">Oluşturulma: @goal.CreatedAt.ToString("dd/MM/yyyy")</small>
                                        </div>
                                        @if (!goal.HasActivities)
                                        {
                                            <form asp-controller="DentalHealth" asp-action="DeleteGoal" method="post" class="d-inline">
                                                @Html.AntiForgeryToken()
                                                <input type="hidden" name="id" value="@goal.Id" />
                                                <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Bu hedefi silmek istediğinizden emin misiniz?')">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </form>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div class="col-12">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>Henüz hedefiniz bulunmuyor. 
                            <a asp-action="CreateGoal" class="alert-link">İlk hedefinizi oluşturun</a>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Handle URL fragment for tab switching
        $(document).ready(function() {
            var activeTab = '@ViewBag.Tab';
            if (activeTab === 'goals') {
                $('#goals-tab').tab('show');
            }
        });
    </script>
}